org.springframework.cloud.function.adapter.aws.FunctionInvoker::handleRequest


BEGIN TRANSACTION;
	BEGIN TRY

		UPDATE EI SET 
		EI.EI_DT_ESTORNO = '' , EI.EI_MOTIVO_ESTORNO = ''  
		FROM TB_GPA_REGISTRO_ENTRADA RG
		JOIN TB_GPA_REG_ENTRADA_ITEM EI ON RG.RN_ID = EI.RN_ID 
		WHERE RG.RN_SITUACAO = 'Finalizada' AND EI.EI_SITUACAO = 'Registrado' AND RG.RN_ID  = 2;

		UPDATE TB_GPA_REGISTRO_ENTRADA SET RN_DT_CRIACAO = DATEADD(day, DATEDIFF(day, RN_DT_CRIACAO, '2016-10-28'), RN_DT_CRIACAO) 
		WHERE RN_SITUACAO = 'Finalizada' AND RN_ID BETWEEN 1 AND 26;

		UPDATE EI SET 
		EI.EI_DT_NOTA_FISCAL = DATEADD(day, DATEDIFF(day, EI.EI_DT_NOTA_FISCAL, '2016-10-28'), EI.EI_DT_NOTA_FISCAL),
		EI.EI_DT_RECEBIMENTO = DATEADD(day, DATEDIFF(day, EI.EI_DT_RECEBIMENTO, '2016-10-28'), EI.EI_DT_RECEBIMENTO)
		FROM TB_GPA_REGISTRO_ENTRADA RG
		JOIN TB_GPA_REG_ENTRADA_ITEM EI ON RG.RN_ID = EI.RN_ID 
		WHERE RG.RN_SITUACAO = 'Finalizada' AND RG.RN_ID BETWEEN 1 AND 26;

		UPDATE TB_GPA_HISTORICO_BEM SET 
		HB_DT_TRANSACAO = DATEADD(day, DATEDIFF(day, HB_DT_TRANSACAO, '2016-10-28'), HB_DT_TRANSACAO) 
		WHERE HB_ID_ORIGEM NOT IN (8,10) AND HB_ID_ORIGEM BETWEEN 1 AND 26;
		
	END TRY
 
    BEGIN CATCH 
		SELECT ERROR_NUMBER()    AS 'ErrorNumber', 
			   ERROR_SEVERITY()  AS 'ErrorSeverity', 
			   ERROR_STATE()     AS 'ErrorState', 
			   ERROR_PROCEDURE() AS 'ErrorProcedure', 
			   ERROR_LINE()      AS 'ErrorLine', 
			   ERROR_MESSAGE()   AS 'ErrorMessage';

		IF @@TRANCOUNT > 0 
		  ROLLBACK TRANSACTION;
	END CATCH

IF @@TRANCOUNT > 0
    COMMIT TRANSACTION;
GO
